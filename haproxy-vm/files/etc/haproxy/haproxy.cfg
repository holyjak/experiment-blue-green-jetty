# This config needs haproxy-1.4
# Start with e.g. sudo haproxy -f /etc/haproxy/haproxy.cfg -d
# See "4.1 Soft-stop using a file on the servers" at
# http://haproxy.1wt.eu/download/1.3/doc/architecture.txt

global
	log 127.0.0.1	local0
	log 127.0.0.1	local1 notice
	#log loghost	local0 info
	maxconn 4096
	#chroot /usr/share/haproxy
	user haproxy
	group haproxy
	daemon
	#debug
	#quiet

defaults
	log	global
	mode	http
	option	httplog
	option	dontlognull
	retries	3
	option redispatch
	maxconn	2000
	contimeout	5000
	clitimeout	50000
	srvtimeout	50000

listen	http_proxy 0.0.0.0:80
        stats enable
        stats uri /stats
        stats refresh 5s
        # stats admin if LOCALHOST # enable en/disabling servers from the web UI
	option	httpchk *
	balance	roundrobin
        # JSESSIONID is set by Jetty, let's reuse it
        # Alternative to the cookie directove: appsession JSESSIONID len 36 timeout 15m request-learn
	cookie JSESSIONID prefix
        option httpchk HEAD /health
        # Default settings for all servers: 
        # (Check every 2 sec, require 2 checks to mark failed/ok [~ 4-5sec])
        default-server inter 2000 rise 2 fall 2
	server	blue 127.0.0.1:8000 cookie blue check
	server	green 127.0.0.1:9000 cookie green check

	#errorloc	502	http://192.168.114.58/error502.html
	#errorfile	503	/etc/haproxy/errors/503.http
	errorfile	400	/etc/haproxy/errors/400.http
	errorfile	403	/etc/haproxy/errors/403.http
	errorfile	408	/etc/haproxy/errors/408.http
	errorfile	500	/etc/haproxy/errors/500.http
	errorfile	502	/etc/haproxy/errors/502.http
	errorfile	503	/etc/haproxy/errors/503.http
	errorfile	504	/etc/haproxy/errors/504.http
